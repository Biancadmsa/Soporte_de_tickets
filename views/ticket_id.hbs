<div class="container">
  <div class="text-center mt-5">
    <h2>Detalle del Ticket</h2>
  </div>
  <div class="ticket-detalle mb-4">
    <table class="table table-bordered">
      <tbody>
        <tr>
          <th scope="row">ID</th>
          <td>{{ticket.id}}</td>
        </tr>
        <tr>
          <th scope="row">Tipo</th>
          <td>{{ticket.tipo}}</td>
        </tr>
        <tr>
          <th scope="row">Descripción</th>
          <td>{{ticket.descripcion}}</td>
        </tr>
        <tr>
          <th scope="row">Fecha de Creación</th>
          <td>{{ticket.fecha_creacion}}</td>
        </tr>
        <tr>
          <th scope="row">Auditado</th>
          <td>{{#if ticket.auditado}}Sí{{else}}No{{/if}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="comentarios mt-5">
    <h3>Comentarios</h3>
    {{#each comentarios}}
    <div class="comentario mb-4 p-3 border rounded">
      <div class="d-flex align-items-center mb-2">
        <img src="/path/to/user-avatar.png" alt="Avatar" class="avatar mr-2">
        <div class="flex-grow-1">
          <strong>{{this.nombre_usuario}}</strong>
        </div>
      </div>
      <p>{{this.mensaje}}</p>
    </div>
    {{/each}}
  </div>

  {{#if esAdministrador}}
  <div class="mt-5">
    <button id="mostrar-formulario" class="btn btn-primary mb-3">Enviar un comentario</button>
    <form id="comentario-form" class="d-none">
      <div class="mb-3">
        <label for="mensaje" class="form-label">Comentario</label>
        <textarea class="form-control" id="mensaje" name="mensaje" rows="3" required></textarea>
      </div>
      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="auditado" name="auditado" value="true" {{#if ticket.auditado}}checked{{/if}}>
        <label class="form-check-label" for="auditado">Marcar como auditado</label>
      </div>
      <button type="submit" class="btn btn-primary">Agregar Comentario</button>
    </form>
  </div>
  {{/if}}
</div>

<script>
  document.getElementById('mostrar-formulario').addEventListener('click', function() {
    document.getElementById('comentario-form').classList.toggle('d-none');
  });

  document.getElementById('comentario-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const mensaje = document.getElementById('mensaje').value;
    const auditado = document.getElementById('auditado').checked;
    const ticketId = {{ticket.id}};
    try {
      const response = await fetch(`/api/tickets/${ticketId}/comentarios`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ mensaje, auditado })
      });
      if (response.ok) {
        window.location.reload();
      } else {
        alert('Error al agregar el comentario');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error al agregar el comentario');
    }
  });
</script>
